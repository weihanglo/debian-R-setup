
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Setting Rsync Daemon Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="backup_scheduled-task.html" />
    
    
    <link rel="prev" href="backup_rsync.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="before_install.html">
            
                <a href="before_install.html">
            
                    
                    Before the Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="install_debian.html">
            
                <a href="install_debian.html">
            
                    
                    Install Debian
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="install_os.html">
            
                <a href="install_os.html">
            
                    
                    Install Debian Operation System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="install_apt.html">
            
                <a href="install_apt.html">
            
                    
                    Configure the APT Package Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="install_lvm.html">
            
                <a href="install_lvm.html">
            
                    
                    Optional: Use LVM for Partition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="install_desktop-env.html">
            
                <a href="install_desktop-env.html">
            
                    
                    Optional: Install Graphical User Desktop Environment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="software.html">
            
                <a href="software.html">
            
                    
                    Softwares Installation and Other Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="software_r.html">
            
                <a href="software_r.html">
            
                    
                    R
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="software_openssh.html">
            
                <a href="software_openssh.html">
            
                    
                    OpenSSH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="software_rstudio.html">
            
                <a href="software_rstudio.html">
            
                    
                    Rstudio Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="software_mariadb.html">
            
                <a href="software_mariadb.html">
            
                    
                    MariaDB
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="backup.html">
            
                <a href="backup.html">
            
                    
                    Backup Your Server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="backup_rsync.html">
            
                <a href="backup_rsync.html">
            
                    
                    Rsync
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.2" data-path="backup_rsync-daemon.html">
            
                <a href="backup_rsync-daemon.html">
            
                    
                    Setting Rsync Daemon
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="backup_scheduled-task.html">
            
                <a href="backup_scheduled-task.html">
            
                    
                    Create Scheduled Tasks to Sync
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="other.html">
            
                <a href="other.html">
            
                    
                    Other Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="other_portmapping.html">
            
                <a href="other_portmapping.html">
            
                    
                    Port Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="other_nginx.html">
            
                <a href="other_nginx.html">
            
                    
                    Nginx and Shiny Server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Setting Rsync Daemon</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="setting-rsync-daemon">Setting rsync daemon</h2>
<p>We already leared about the powerful rsync for transferring files. Now, we will implement rsync on a Network-attached Storage (NAS). Assumed we have two server2 and one NAS. All these devices is connected with each other via <a href="https://en.wikipedia.org/wiki/Local_area_network" target="_blank">local area network</a> (LAN). </p>
<p>The port mapping is as following:</p>
<ul>
<li>server1: 192.168.0.1</li>
<li>server2: 192.168.0.2</li>
<li>myNAS:  192.168.0.3</li>
</ul>
<p>And we have two different to backup files from servers seperately. (though volumes can be the same partition technically)</p>
<ul>
<li>server1 /home/ -----&gt; sync to NAS /volumes/server1</li>
<li>server2 /home/important -----&gt; sync to NAS /volumes/server2/important</li>
</ul>
<h3 id="0-what-is-nas">0. What is NAS?</h3>
<p><a href="https://en.wikipedia.org/wiki/Network-attached_storage" target="_blank">NAS</a> is just an self-contained, file-level storage server connected to a network. It is actually a tiny computer that powered with some abilities to store and aceess files more elegantly. In this manual, we would use the <strong>Synology</strong>&apos;s NAS for example.</p>
<p>Before we start, you must setup all the volume, RAID, and other stuff in your NAS. Synology&apos;s product have a decent web-base operating system called DiskStation Manager (DSM). You can read their <a href="https://www.synology.com/en-global/knowledgebase/DSM/help/DSM/MainMenu/get_started" target="_blank">documents</a> to get started.</p>
<h3 id="1-enable-rsync-daemon-via-operating-system-of-your-nas">1. Enable rsync daemon via operating system of your NAS</h3>
<p>First, login DSM. Open the <strong>Control Panel</strong>, then select <strong>File Services</strong>.</p>
<p><img src="../img/backup-nas-1.png" height="400px">
<img src="../img/backup-nas-2.png" height="400px"></p>
<p>Check the <strong>Enable rsync service</strong> field.</p>
<p><img src="../img/backup-nas-3.png" height="400px"></p>
<p>Then, add your super user as a rsync account to enable rsync daemon access.</p>
<p><img src="../img/backup-nas-4.png" height="400px"></p>
<h3 id="2-write-your-own-rsyncdconf">2. Write your own <code>rsyncd.conf</code></h3>
<p>After previous steps, NAS start rsyncd daemon automatically for you. The rest you have to do is specify different setting between servers. </p>
<p>While we enable rsync in NAS DSM, we also enable ssh via TCP port 22 by default. However, the ssh service on NAS system is only for local network usage. We would keep it in LAN. No port forwardgin to WAN.</p>
<p>Thus, if we want to ssh-login NAS system, we need to use either a device in the same LAN.</p>
<pre><code class="lang-bash"><span class="hljs-comment"># Login in NAS system via **server1**</span>
user@server1$ ssh user@192.168.0.3

...

<span class="hljs-comment"># Logged in NAS</span>
user@myNAS$
</code></pre>
<p>Next, open the rsync configure file <code>/etc/rsyncd.conf</code>.</p>
<pre><code class="lang-bash">user@myNAS$ sudo vim /etc/rsyncd.conf
</code></pre>
<p>Here are a example <code>rsyncd.conf</code> file:</p>
<pre><code>#---------------------------------------
# global parameters
#---------------------------------------

#motd file = /etc/rsyncd.motd
log file = /var/log/rsyncd.log          # file storing logs
pid file = /var/run/rsyncd.pid          # file recording their process ID
lock file = /var/run/rsync.lock         # file to ensure separation of two instance of a program

auth users = user, root                 # local users that can connect to a rsync daemon
uid = root                              # ID of the user that executes rsync daemon
gid = root                              # group Id of the user&apos;s group executing rsync daemon
use chroot = no                         # if true, will *chroot* to the path. Need root privilege
charset = utf-8                         # UTF-8 character set
list = yes                              # would list modules when the client asking
read only = no                          # default is read only, should be *no* for write files
reverse lookup = no                     # *no* for save time
secrets file = /etc/rsyncd.secrets      # contains *username:password* pattern for authentication
dont compress = *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz *.RData
                                        # dont compress these files

#---------------------------------------
# module parameters
#---------------------------------------

[server1]                               # This is the **MODULE** name
comment = Back Up Module for server1    # would display while client ask the module list
path = /volume1/server1                 # the path to backup in the daemon&apos;s filesystem 
hosts allow = 192.168.11.102            # host allow to connect. We allow only LAN-side IP for security issue

[server2-important]
comment = Back Up Module for server2 important files
path = /volumes/server2
hosts allow = 192.168.11.103            # a module a host to avoid accidentally sync the wrong remote
</code></pre><p>After finishing configure <code>rsyncd.conf</code>, you should create secrets file at the path you specified. Assumed you set the path at <code>/etc/rsyncd.secrets</code>. Open it.</p>
<pre><code class="lang-bash">user@myNAS$ sudo vim /etc/rsyncd.secrets
</code></pre>
<p>Then follow the <code>username:password</code> pattern for the authentication. <strong><em>For security issue</em>, try to avoid using the same password as the server account.</strong></p>
<pre><code>user:mypassword
root:rootHasItsOwnPassword
</code></pre><p>And the <strong>important</strong> part. You should use <code>chmod</code> to change access for the secrets file, otherwise rsyncd wont be able to work.</p>
<pre><code class="lang-bash"><span class="hljs-comment"># only file owner can read/write the file</span>
user@myNAS$ sudo chmod 600 /etc/rsyncd.secrets
</code></pre>
<p>At last, check there isn&apos;t any process running. Then reboot you NAS (Maybe there is another way to restart rsync daemon, but I have no idea with Synology DSM.)</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="backup_rsync.html" class="navigation navigation-prev " aria-label="Previous page: Rsync">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="backup_scheduled-task.html" class="navigation navigation-next " aria-label="Next page: Create Scheduled Tasks to Sync">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Setting Rsync Daemon","level":"1.5.2","depth":2,"next":{"title":"Create Scheduled Tasks to Sync","level":"1.5.3","depth":2,"path":"doc/backup_scheduled-task.md","ref":"doc/backup_scheduled-task.md","articles":[]},"previous":{"title":"Rsync","level":"1.5.1","depth":2,"path":"doc/backup_rsync.md","ref":"doc/backup_rsync.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"doc/backup_rsync-daemon.md","mtime":"2019-11-24T02:51:53.666Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-11-24T02:52:51.481Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

